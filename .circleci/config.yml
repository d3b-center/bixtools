version: 2.1
orbs:
  docker: circleci/docker@1.3.0
commands:
  run_if_modified:
    description: Run steps if files are modified
    parameters:
      always-run-on-branch:
        default: ''
        description: The branch to always run the steps on
        type: string
      base-branch:
        default: master
        description: The branch against which to check against. This can also be a
          commit SHA
        type: string
      check-last-commit-on-base-branch:
        default: false
        description: This will make the check run for the latest commit on the base
          branch.
        type: boolean
      pattern:
        default: .*
        description: |
          The regex to match files against. The command uses grep to search file names.
          If you want to enforce starting with use ^. For checking if files in src/ or lib/ were modified,
          the pattern to use would be ^src.*|^lib.*
        type: string
      steps-to-run:
        default: []
        description: The steps to run if the files mentioned are modified
        type: steps
      use-divergence-point:
        default: false
        description: Find the divergence from the branch passed above, rather than
          the current HEAD
        type: boolean
    steps:
    - run:
        command: |
          if [ -z "$BASH" ]; then
            echo Bash not installed.
            exit 1
          fi
          git status >/dev/null 2>&1 || { echo >&2 "Not in a git directory or no git"; exit 1; }
          circleci-agent >/dev/null 2>&1 || { echo >&2 "No Circle CI agent. These are in all Circle CI containers"; exit 1; }

          if [ "$CIRCLE_BRANCH" == "<< parameters.always-run-on-branch >>" ]; then
            echo "Should always run on << parameters.always-run-on-branch >>. Exiting and continuing to run"
            exit 0;
          fi

          FILES_MODIFIED=""
          setcommit () {
            FILES_MODIFIED=$(git diff --name-only origin/<< parameters.base-branch >>..HEAD | grep -i -E '<< parameters.pattern >>')
            <<# parameters.use-divergence-point >>
            FILES_MODIFIED=$(git diff --name-only $(git merge-base HEAD origin/<< parameters.base-branch >>)..HEAD | grep -i -E '<< parameters.pattern >>')
            <</ parameters.use-divergence-point >>
            <<# parameters.check-last-commit-on-base-branch >>
            if [[ "$CIRCLE_BRANCH" == "<< parameters.base-branch >>" ]]; then
              FILES_MODIFIED=$(git diff --name-only HEAD HEAD~1 | grep -i -E '<< parameters.pattern >>')
            fi
            <</ parameters.check-last-commit-on-base-branch >>
          }

          setcommit || true
          if [ -z "$FILES_MODIFIED" ]
          then
            echo "Files not modified. Halting job"
            circleci-agent step halt
          else
            echo "Files modified, continuing steps"
          fi
        name: Only run if modified
    - steps: << parameters.steps-to-run >>
workflows:
  monthly:
    triggers:
    - schedule:
        cron: '* * 1 * *'
        filters:
          branches:
            only:
            - master
    jobs:
    - docker/publish:
        name: verifybamid_latest_monthly
        deploy: false
        image: kfdrc/verifybamid
        tag: latest
        path: verifybamid/latest/
        docker-context: verifybamid/latest/
    - docker/publish:
        name: verifybamid_1.0.1_monthly
        deploy: false
        image: kfdrc/verifybamid
        tag: 1.0.1
        path: verifybamid/1.0.1/
        docker-context: verifybamid/1.0.1/
    - docker/publish:
        name: verifybamid_1.0.2_monthly
        deploy: false
        image: kfdrc/verifybamid
        tag: 1.0.2
        path: verifybamid/1.0.2/
        docker-context: verifybamid/1.0.2/
    - docker/publish:
        name: arriba_latest_monthly
        deploy: false
        image: kfdrc/arriba
        tag: latest
        path: arriba/latest/
        docker-context: arriba/latest/
    - docker/publish:
        name: arriba_1.0.1_monthly
        deploy: false
        image: kfdrc/arriba
        tag: 1.0.1
        path: arriba/1.0.1/
        docker-context: arriba/1.0.1/
    - docker/publish:
        name: arriba_1.1.0_monthly
        deploy: false
        image: kfdrc/arriba
        tag: 1.1.0
        path: arriba/1.1.0/
        docker-context: arriba/1.1.0/
    - docker/publish:
        name: picard_2.14.0_monthly
        deploy: false
        image: kfdrc/picard
        tag: 2.14.0
        path: picard/2.14.0/
        docker-context: picard/2.14.0/
    - docker/publish:
        name: picard_latest_monthly
        deploy: false
        image: kfdrc/picard
        tag: latest
        path: picard/latest/
        docker-context: picard/latest/
    - docker/publish:
        name: picard_2.8.3_monthly
        deploy: false
        image: kfdrc/picard
        tag: 2.8.3
        path: picard/2.8.3/
        docker-context: picard/2.8.3/
    - docker/publish:
        name: picard_2.18.9_monthly
        deploy: false
        image: kfdrc/picard
        tag: 2.18.9
        path: picard/2.18.9/
        docker-context: picard/2.18.9/
    - docker/publish:
        name: picard_2.17.4_monthly
        deploy: false
        image: kfdrc/picard
        tag: 2.17.4
        path: picard/2.17.4/
        docker-context: picard/2.17.4/
    - docker/publish:
        name: picard_2.15.0_monthly
        deploy: false
        image: kfdrc/picard
        tag: 2.15.0
        path: picard/2.15.0/
        docker-context: picard/2.15.0/
    - docker/publish:
        name: lumpy-sv_0.3.0_monthly
        deploy: false
        image: kfdrc/lumpy-sv
        tag: 0.3.0
        path: lumpy-sv/0.3.0/
        docker-context: lumpy-sv/0.3.0/
    - docker/publish:
        name: lumpy-sv_0.2.13_monthly
        deploy: false
        image: kfdrc/lumpy-sv
        tag: 0.2.13
        path: lumpy-sv/0.2.13/
        docker-context: lumpy-sv/0.2.13/
    - docker/publish:
        name: SVTyper_0.7.1_monthly
        deploy: false
        image: kfdrc/SVTyper
        tag: 0.7.1
        path: SVTyper/0.7.1/
        docker-context: SVTyper/0.7.1/
    - docker/publish:
        name: cutadapt_latest_monthly
        deploy: false
        image: kfdrc/cutadapt
        tag: latest
        path: cutadapt/latest/
        docker-context: cutadapt/latest/
    - docker/publish:
        name: VarDictJava_fp_filter_monthly
        deploy: false
        image: kfdrc/VarDictJava
        tag: fp_filter
        path: VarDictJava/fp_filter/
        docker-context: VarDictJava/fp_filter/
    - docker/publish:
        name: VarDictJava_1.5.8_monthly
        deploy: false
        image: kfdrc/VarDictJava
        tag: 1.5.8
        path: VarDictJava/1.5.8/
        docker-context: VarDictJava/1.5.8/
    - docker/publish:
        name: bwa-picard_latest_monthly
        deploy: false
        image: kfdrc/bwa-picard
        tag: latest
        path: bwa-picard/latest/
        docker-context: bwa-picard/latest/
    - docker/publish:
        name: bwa-picard_broad_monthly
        deploy: false
        image: kfdrc/bwa-picard
        tag: broad
        path: bwa-picard/broad/
        docker-context: bwa-picard/broad/
    - docker/publish:
        name: python_2.7.13_monthly
        deploy: false
        image: kfdrc/python
        tag: 2.7.13
        path: python/2.7.13/
        docker-context: python/2.7.13/
    - docker/publish:
        name: smoove_0.2.5_monthly
        deploy: false
        image: kfdrc/smoove
        tag: 0.2.5
        path: smoove/0.2.5/
        docker-context: smoove/0.2.5/
    - docker/publish:
        name: cellranger_3.1_monthly
        deploy: false
        image: kfdrc/cellranger
        tag: '3.1'
        path: cellranger/3.1/
        docker-context: cellranger/3.1/
    - docker/publish:
        name: bcbio_variation_recall-0.2.4_monthly
        deploy: false
        image: kfdrc/bcbio
        tag: variation_recall-0.2.4
        path: bcbio/variation_recall-0.2.4/
        docker-context: bcbio/variation_recall-0.2.4/
    - docker/publish:
        name: bwa-bundle_0.1.17_monthly
        deploy: false
        image: kfdrc/bwa-bundle
        tag: 0.1.17
        path: bwa-bundle/0.1.17/
        docker-context: bwa-bundle/0.1.17/
    - docker/publish:
        name: gatk-picard_4.beta.1-2.8.3_monthly
        deploy: false
        image: kfdrc/gatk-picard
        tag: 4.beta.1-2.8.3
        path: gatk-picard/4.beta.1-2.8.3/
        docker-context: gatk-picard/4.beta.1-2.8.3/
    - docker/publish:
        name: gatk-picard_4.0.1.2-2.8.3_monthly
        deploy: false
        image: kfdrc/gatk-picard
        tag: 4.0.1.2-2.8.3
        path: gatk-picard/4.0.1.2-2.8.3/
        docker-context: gatk-picard/4.0.1.2-2.8.3/
    - docker/publish:
        name: manta_1.6_monthly
        deploy: false
        image: kfdrc/manta
        tag: '1.6'
        path: manta/1.6/
        docker-context: manta/1.6/
    - docker/publish:
        name: manta_1.4_monthly
        deploy: false
        image: kfdrc/manta
        tag: '1.4'
        path: manta/1.4/
        docker-context: manta/1.4/
    - docker/publish:
        name: velocyto_0.17.17_monthly
        deploy: false
        image: kfdrc/velocyto
        tag: 0.17.17
        path: velocyto/0.17.17/
        docker-context: velocyto/0.17.17/
    - docker/publish:
        name: speedseq_latest_monthly
        deploy: false
        image: kfdrc/speedseq
        tag: latest
        path: speedseq/latest/
        docker-context: speedseq/latest/
    - docker/publish:
        name: svaba_1.1.0_monthly
        deploy: false
        image: kfdrc/svaba
        tag: 1.1.0
        path: svaba/1.1.0/
        docker-context: svaba/1.1.0/
    - docker/publish:
        name: lancet_1.0.7_monthly
        deploy: false
        image: kfdrc/lancet
        tag: 1.0.7
        path: lancet/1.0.7/
        docker-context: lancet/1.0.7/
    - docker/publish:
        name: sambamba_0.7.1_monthly
        deploy: false
        image: kfdrc/sambamba
        tag: 0.7.1
        path: sambamba/0.7.1/
        docker-context: sambamba/0.7.1/
    - docker/publish:
        name: sambamba_0.6.3_monthly
        deploy: false
        image: kfdrc/sambamba
        tag: 0.6.3
        path: sambamba/0.6.3/
        docker-context: sambamba/0.6.3/
    - docker/publish:
        name: picard-r_picard2.8.3-r3.3.3_monthly
        deploy: false
        image: kfdrc/picard-r
        tag: picard2.8.3-r3.3.3
        path: picard-r/picard2.8.3-r3.3.3/
        docker-context: picard-r/picard2.8.3-r3.3.3/
    - docker/publish:
        name: picard-r_picard2.15.0-r.3.3.3_monthly
        deploy: false
        image: kfdrc/picard-r
        tag: picard2.15.0-r.3.3.3
        path: picard-r/picard2.15.0-r.3.3.3/
        docker-context: picard-r/picard2.15.0-r.3.3.3/
    - docker/publish:
        name: VEP_r98_monthly
        deploy: false
        image: kfdrc/VEP
        tag: r98
        path: VEP/r98/
        docker-context: VEP/r98/
    - docker/publish:
        name: VEP_r93_v2_monthly
        deploy: false
        image: kfdrc/VEP
        tag: r93_v2
        path: VEP/r93_v2/
        docker-context: VEP/r93_v2/
    - docker/publish:
        name: VEP_r94_monthly
        deploy: false
        image: kfdrc/VEP
        tag: r94
        path: VEP/r94/
        docker-context: VEP/r94/
    - docker/publish:
        name: VEP_r93_monthly
        deploy: false
        image: kfdrc/VEP
        tag: r93
        path: VEP/r93/
        docker-context: VEP/r93/
    - docker/publish:
        name: canvas_1.11.0_monthly
        deploy: false
        image: kfdrc/canvas
        tag: 1.11.0
        path: canvas/1.11.0/
        docker-context: canvas/1.11.0/
    - docker/publish:
        name: bwa_0.7.15-r1140_monthly
        deploy: false
        image: kfdrc/bwa
        tag: 0.7.15-r1140
        path: bwa/0.7.15-r1140/
        docker-context: bwa/0.7.15-r1140/
    - docker/publish:
        name: bwa_latest_monthly
        deploy: false
        image: kfdrc/bwa
        tag: latest
        path: bwa/latest/
        docker-context: bwa/latest/
    - docker/publish:
        name: bwa_0.7.17-r1188_monthly
        deploy: false
        image: kfdrc/bwa
        tag: 0.7.17-r1188
        path: bwa/0.7.17-r1188/
        docker-context: bwa/0.7.17-r1188/
    - docker/publish:
        name: star_2.7.5a_monthly
        deploy: false
        image: kfdrc/star
        tag: 2.7.5a
        path: star/2.7.5a/
        docker-context: star/2.7.5a/
    - docker/publish:
        name: star_2.6.1d_monthly
        deploy: false
        image: kfdrc/star
        tag: 2.6.1d
        path: star/2.6.1d/
        docker-context: star/2.6.1d/
    - docker/publish:
        name: star_fusion-1.5.0_monthly
        deploy: false
        image: kfdrc/star
        tag: fusion-1.5.0
        path: star/fusion-1.5.0/
        docker-context: star/fusion-1.5.0/
    - docker/publish:
        name: codex2_3.8_monthly
        deploy: false
        image: kfdrc/codex2
        tag: '3.8'
        path: codex2/3.8/
        docker-context: codex2/3.8/
    - docker/publish:
        name: sv2_latest_monthly
        deploy: false
        image: kfdrc/sv2
        tag: latest
        path: sv2/latest/
        docker-context: sv2/latest/
    - docker/publish:
        name: FusionCatcher_latest_monthly
        deploy: false
        image: kfdrc/FusionCatcher
        tag: latest
        path: FusionCatcher/latest/
        docker-context: FusionCatcher/latest/
    - docker/publish:
        name: controlfreec_11.5_monthly
        deploy: false
        image: kfdrc/controlfreec
        tag: '11.5'
        path: controlfreec/11.5/
        docker-context: controlfreec/11.5/
    - docker/publish:
        name: LinkedSV_latest_monthly
        deploy: false
        image: kfdrc/LinkedSV
        tag: latest
        path: LinkedSV/latest/
        docker-context: LinkedSV/latest/
    - docker/publish:
        name: gatk_4.beta.6_monthly
        deploy: false
        image: kfdrc/gatk
        tag: 4.beta.6
        path: gatk/4.beta.6/
        docker-context: gatk/4.beta.6/
    - docker/publish:
        name: gatk_4.0.1.0_monthly
        deploy: false
        image: kfdrc/gatk
        tag: 4.0.1.0
        path: gatk/4.0.1.0/
        docker-context: gatk/4.0.1.0/
    - docker/publish:
        name: gatk_4.beta.1_monthly
        deploy: false
        image: kfdrc/gatk
        tag: 4.beta.1
        path: gatk/4.beta.1/
        docker-context: gatk/4.beta.1/
    - docker/publish:
        name: gatk_4.1.1.0_monthly
        deploy: false
        image: kfdrc/gatk
        tag: 4.1.1.0
        path: gatk/4.1.1.0/
        docker-context: gatk/4.1.1.0/
    - docker/publish:
        name: gatk_4.beta.1-3.5_monthly
        deploy: false
        image: kfdrc/gatk
        tag: 4.beta.1-3.5
        path: gatk/4.beta.1-3.5/
        docker-context: gatk/4.beta.1-3.5/
    - docker/publish:
        name: gatk_4.1.7.0R_monthly
        deploy: false
        image: kfdrc/gatk
        tag: 4.1.7.0R
        path: gatk/4.1.7.0R/
        docker-context: gatk/4.1.7.0R/
    - docker/publish:
        name: gatk_4.beta.5-tabix_monthly
        deploy: false
        image: kfdrc/gatk
        tag: 4.beta.5-tabix
        path: gatk/4.beta.5-tabix/
        docker-context: gatk/4.beta.5-tabix/
    - docker/publish:
        name: gatk_4.0.12.0_monthly
        deploy: false
        image: kfdrc/gatk
        tag: 4.0.12.0
        path: gatk/4.0.12.0/
        docker-context: gatk/4.0.12.0/
    - docker/publish:
        name: gatk_latest_monthly
        deploy: false
        image: kfdrc/gatk
        tag: latest
        path: gatk/latest/
        docker-context: gatk/latest/
    - docker/publish:
        name: gatk_3.8_ubuntu_monthly
        deploy: false
        image: kfdrc/gatk
        tag: 3.8_ubuntu
        path: gatk/3.8_ubuntu/
        docker-context: gatk/3.8_ubuntu/
    - docker/publish:
        name: gatk_4.beta.6-tabix_monthly
        deploy: false
        image: kfdrc/gatk
        tag: 4.beta.6-tabix
        path: gatk/4.beta.6-tabix/
        docker-context: gatk/4.beta.6-tabix/
    - docker/publish:
        name: gatk_4.0.5.2_monthly
        deploy: false
        image: kfdrc/gatk
        tag: 4.0.5.2
        path: gatk/4.0.5.2/
        docker-context: gatk/4.0.5.2/
    - docker/publish:
        name: gatk_3.5-0-g36282e4_monthly
        deploy: false
        image: kfdrc/gatk
        tag: 3.5-0-g36282e4
        path: gatk/3.5-0-g36282e4/
        docker-context: gatk/3.5-0-g36282e4/
    - docker/publish:
        name: gatk_4.beta.5_monthly
        deploy: false
        image: kfdrc/gatk
        tag: 4.beta.5
        path: gatk/4.beta.5/
        docker-context: gatk/4.beta.5/
    - docker/publish:
        name: gatk_3.6-0-g89b7209_monthly
        deploy: false
        image: kfdrc/gatk
        tag: 3.6-0-g89b7209
        path: gatk/3.6-0-g89b7209/
        docker-context: gatk/3.6-0-g89b7209/
    - docker/publish:
        name: gatk_4.0.1.2_monthly
        deploy: false
        image: kfdrc/gatk
        tag: 4.0.1.2
        path: gatk/4.0.1.2/
        docker-context: gatk/4.0.1.2/
    - docker/publish:
        name: gatk_3.8_monthly
        deploy: false
        image: kfdrc/gatk
        tag: '3.8'
        path: gatk/3.8/
        docker-context: gatk/3.8/
    - docker/publish:
        name: bed_tools_bedopsv2.4.36_plus_bedtools_monthly
        deploy: false
        image: kfdrc/bed_tools
        tag: bedopsv2.4.36_plus_bedtools
        path: bed_tools/bedopsv2.4.36_plus_bedtools/
        docker-context: bed_tools/bedopsv2.4.36_plus_bedtools/
    - docker/publish:
        name: peddy_latest_monthly
        deploy: false
        image: kfdrc/peddy
        tag: latest
        path: peddy/latest/
        docker-context: peddy/latest/
    - docker/publish:
        name: samtools_1.7-11-g041220d_monthly
        deploy: false
        image: kfdrc/samtools
        tag: 1.7-11-g041220d
        path: samtools/1.7-11-g041220d/
        docker-context: samtools/1.7-11-g041220d/
    - docker/publish:
        name: samtools_1.9_monthly
        deploy: false
        image: kfdrc/samtools
        tag: '1.9'
        path: samtools/1.9/
        docker-context: samtools/1.9/
    - docker/publish:
        name: samtools_1.6_monthly
        deploy: false
        image: kfdrc/samtools
        tag: '1.6'
        path: samtools/1.6/
        docker-context: samtools/1.6/
    - docker/publish:
        name: samtools_1.3.1_monthly
        deploy: false
        image: kfdrc/samtools
        tag: 1.3.1
        path: samtools/1.3.1/
        docker-context: samtools/1.3.1/
    - docker/publish:
        name: samtools_latest_monthly
        deploy: false
        image: kfdrc/samtools
        tag: latest
        path: samtools/latest/
        docker-context: samtools/latest/
    - docker/publish:
        name: annovar_latest_monthly
        deploy: false
        image: kfdrc/annovar
        tag: latest
        path: annovar/latest/
        docker-context: annovar/latest/
    - docker/publish:
        name: seurat_latest_monthly
        deploy: false
        image: kfdrc/seurat
        tag: latest
        path: seurat/latest/
        docker-context: seurat/latest/
    - docker/publish:
        name: annoFuse_0.1.8_monthly
        deploy: false
        image: kfdrc/annoFuse
        tag: 0.1.8
        path: annoFuse/0.1.8/
        docker-context: annoFuse/0.1.8/
    - docker/publish:
        name: pizzly_latest_monthly
        deploy: false
        image: kfdrc/pizzly
        tag: latest
        path: pizzly/latest/
        docker-context: pizzly/latest/
    - docker/publish:
        name: BIC-seq2_0.7.2_monthly
        deploy: false
        image: kfdrc/BIC-seq2
        tag: 0.7.2
        path: BIC-seq2/0.7.2/
        docker-context: BIC-seq2/0.7.2/
  diff:
    jobs:
    - docker/publish:
        context: dockerhub-vars
        name: verifybamid_latest_diff
        deploy: true
        image: kfdrc/verifybamid
        tag: latest
        path: verifybamid/latest/
        docker-context: verifybamid/latest/
        before_build:
        - run_if_modified:
            pattern: verifybamid/latest/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: verifybamid_1.0.1_diff
        deploy: true
        image: kfdrc/verifybamid
        tag: 1.0.1
        path: verifybamid/1.0.1/
        docker-context: verifybamid/1.0.1/
        before_build:
        - run_if_modified:
            pattern: verifybamid/1.0.1/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: verifybamid_1.0.2_diff
        deploy: true
        image: kfdrc/verifybamid
        tag: 1.0.2
        path: verifybamid/1.0.2/
        docker-context: verifybamid/1.0.2/
        before_build:
        - run_if_modified:
            pattern: verifybamid/1.0.2/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: arriba_latest_diff
        deploy: true
        image: kfdrc/arriba
        tag: latest
        path: arriba/latest/
        docker-context: arriba/latest/
        before_build:
        - run_if_modified:
            pattern: arriba/latest/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: arriba_1.0.1_diff
        deploy: true
        image: kfdrc/arriba
        tag: 1.0.1
        path: arriba/1.0.1/
        docker-context: arriba/1.0.1/
        before_build:
        - run_if_modified:
            pattern: arriba/1.0.1/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: arriba_1.1.0_diff
        deploy: true
        image: kfdrc/arriba
        tag: 1.1.0
        path: arriba/1.1.0/
        docker-context: arriba/1.1.0/
        before_build:
        - run_if_modified:
            pattern: arriba/1.1.0/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: picard_2.14.0_diff
        deploy: true
        image: kfdrc/picard
        tag: 2.14.0
        path: picard/2.14.0/
        docker-context: picard/2.14.0/
        before_build:
        - run_if_modified:
            pattern: picard/2.14.0/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: picard_latest_diff
        deploy: true
        image: kfdrc/picard
        tag: latest
        path: picard/latest/
        docker-context: picard/latest/
        before_build:
        - run_if_modified:
            pattern: picard/latest/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: picard_2.8.3_diff
        deploy: true
        image: kfdrc/picard
        tag: 2.8.3
        path: picard/2.8.3/
        docker-context: picard/2.8.3/
        before_build:
        - run_if_modified:
            pattern: picard/2.8.3/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: picard_2.18.9_diff
        deploy: true
        image: kfdrc/picard
        tag: 2.18.9
        path: picard/2.18.9/
        docker-context: picard/2.18.9/
        before_build:
        - run_if_modified:
            pattern: picard/2.18.9/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: picard_2.17.4_diff
        deploy: true
        image: kfdrc/picard
        tag: 2.17.4
        path: picard/2.17.4/
        docker-context: picard/2.17.4/
        before_build:
        - run_if_modified:
            pattern: picard/2.17.4/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: picard_2.15.0_diff
        deploy: true
        image: kfdrc/picard
        tag: 2.15.0
        path: picard/2.15.0/
        docker-context: picard/2.15.0/
        before_build:
        - run_if_modified:
            pattern: picard/2.15.0/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: lumpy-sv_0.3.0_diff
        deploy: true
        image: kfdrc/lumpy-sv
        tag: 0.3.0
        path: lumpy-sv/0.3.0/
        docker-context: lumpy-sv/0.3.0/
        before_build:
        - run_if_modified:
            pattern: lumpy-sv/0.3.0/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: lumpy-sv_0.2.13_diff
        deploy: true
        image: kfdrc/lumpy-sv
        tag: 0.2.13
        path: lumpy-sv/0.2.13/
        docker-context: lumpy-sv/0.2.13/
        before_build:
        - run_if_modified:
            pattern: lumpy-sv/0.2.13/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: SVTyper_0.7.1_diff
        deploy: true
        image: kfdrc/SVTyper
        tag: 0.7.1
        path: SVTyper/0.7.1/
        docker-context: SVTyper/0.7.1/
        before_build:
        - run_if_modified:
            pattern: SVTyper/0.7.1/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: cutadapt_latest_diff
        deploy: true
        image: kfdrc/cutadapt
        tag: latest
        path: cutadapt/latest/
        docker-context: cutadapt/latest/
        before_build:
        - run_if_modified:
            pattern: cutadapt/latest/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: VarDictJava_fp_filter_diff
        deploy: true
        image: kfdrc/VarDictJava
        tag: fp_filter
        path: VarDictJava/fp_filter/
        docker-context: VarDictJava/fp_filter/
        before_build:
        - run_if_modified:
            pattern: VarDictJava/fp_filter/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: VarDictJava_1.5.8_diff
        deploy: true
        image: kfdrc/VarDictJava
        tag: 1.5.8
        path: VarDictJava/1.5.8/
        docker-context: VarDictJava/1.5.8/
        before_build:
        - run_if_modified:
            pattern: VarDictJava/1.5.8/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: bwa-picard_latest_diff
        deploy: true
        image: kfdrc/bwa-picard
        tag: latest
        path: bwa-picard/latest/
        docker-context: bwa-picard/latest/
        before_build:
        - run_if_modified:
            pattern: bwa-picard/latest/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: bwa-picard_broad_diff
        deploy: true
        image: kfdrc/bwa-picard
        tag: broad
        path: bwa-picard/broad/
        docker-context: bwa-picard/broad/
        before_build:
        - run_if_modified:
            pattern: bwa-picard/broad/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: python_2.7.13_diff
        deploy: true
        image: kfdrc/python
        tag: 2.7.13
        path: python/2.7.13/
        docker-context: python/2.7.13/
        before_build:
        - run_if_modified:
            pattern: python/2.7.13/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: smoove_0.2.5_diff
        deploy: true
        image: kfdrc/smoove
        tag: 0.2.5
        path: smoove/0.2.5/
        docker-context: smoove/0.2.5/
        before_build:
        - run_if_modified:
            pattern: smoove/0.2.5/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: cellranger_3.1_diff
        deploy: true
        image: kfdrc/cellranger
        tag: '3.1'
        path: cellranger/3.1/
        docker-context: cellranger/3.1/
        before_build:
        - run_if_modified:
            pattern: cellranger/3.1/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: bcbio_variation_recall-0.2.4_diff
        deploy: true
        image: kfdrc/bcbio
        tag: variation_recall-0.2.4
        path: bcbio/variation_recall-0.2.4/
        docker-context: bcbio/variation_recall-0.2.4/
        before_build:
        - run_if_modified:
            pattern: bcbio/variation_recall-0.2.4/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: bwa-bundle_0.1.17_diff
        deploy: true
        image: kfdrc/bwa-bundle
        tag: 0.1.17
        path: bwa-bundle/0.1.17/
        docker-context: bwa-bundle/0.1.17/
        before_build:
        - run_if_modified:
            pattern: bwa-bundle/0.1.17/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: gatk-picard_4.beta.1-2.8.3_diff
        deploy: true
        image: kfdrc/gatk-picard
        tag: 4.beta.1-2.8.3
        path: gatk-picard/4.beta.1-2.8.3/
        docker-context: gatk-picard/4.beta.1-2.8.3/
        before_build:
        - run_if_modified:
            pattern: gatk-picard/4.beta.1-2.8.3/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: gatk-picard_4.0.1.2-2.8.3_diff
        deploy: true
        image: kfdrc/gatk-picard
        tag: 4.0.1.2-2.8.3
        path: gatk-picard/4.0.1.2-2.8.3/
        docker-context: gatk-picard/4.0.1.2-2.8.3/
        before_build:
        - run_if_modified:
            pattern: gatk-picard/4.0.1.2-2.8.3/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: manta_1.6_diff
        deploy: true
        image: kfdrc/manta
        tag: '1.6'
        path: manta/1.6/
        docker-context: manta/1.6/
        before_build:
        - run_if_modified:
            pattern: manta/1.6/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: manta_1.4_diff
        deploy: true
        image: kfdrc/manta
        tag: '1.4'
        path: manta/1.4/
        docker-context: manta/1.4/
        before_build:
        - run_if_modified:
            pattern: manta/1.4/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: velocyto_0.17.17_diff
        deploy: true
        image: kfdrc/velocyto
        tag: 0.17.17
        path: velocyto/0.17.17/
        docker-context: velocyto/0.17.17/
        before_build:
        - run_if_modified:
            pattern: velocyto/0.17.17/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: speedseq_latest_diff
        deploy: true
        image: kfdrc/speedseq
        tag: latest
        path: speedseq/latest/
        docker-context: speedseq/latest/
        before_build:
        - run_if_modified:
            pattern: speedseq/latest/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: svaba_1.1.0_diff
        deploy: true
        image: kfdrc/svaba
        tag: 1.1.0
        path: svaba/1.1.0/
        docker-context: svaba/1.1.0/
        before_build:
        - run_if_modified:
            pattern: svaba/1.1.0/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: lancet_1.0.7_diff
        deploy: true
        image: kfdrc/lancet
        tag: 1.0.7
        path: lancet/1.0.7/
        docker-context: lancet/1.0.7/
        before_build:
        - run_if_modified:
            pattern: lancet/1.0.7/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: sambamba_0.7.1_diff
        deploy: true
        image: kfdrc/sambamba
        tag: 0.7.1
        path: sambamba/0.7.1/
        docker-context: sambamba/0.7.1/
        before_build:
        - run_if_modified:
            pattern: sambamba/0.7.1/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: sambamba_0.6.3_diff
        deploy: true
        image: kfdrc/sambamba
        tag: 0.6.3
        path: sambamba/0.6.3/
        docker-context: sambamba/0.6.3/
        before_build:
        - run_if_modified:
            pattern: sambamba/0.6.3/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: picard-r_picard2.8.3-r3.3.3_diff
        deploy: true
        image: kfdrc/picard-r
        tag: picard2.8.3-r3.3.3
        path: picard-r/picard2.8.3-r3.3.3/
        docker-context: picard-r/picard2.8.3-r3.3.3/
        before_build:
        - run_if_modified:
            pattern: picard-r/picard2.8.3-r3.3.3/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: picard-r_picard2.15.0-r.3.3.3_diff
        deploy: true
        image: kfdrc/picard-r
        tag: picard2.15.0-r.3.3.3
        path: picard-r/picard2.15.0-r.3.3.3/
        docker-context: picard-r/picard2.15.0-r.3.3.3/
        before_build:
        - run_if_modified:
            pattern: picard-r/picard2.15.0-r.3.3.3/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: VEP_r98_diff
        deploy: true
        image: kfdrc/VEP
        tag: r98
        path: VEP/r98/
        docker-context: VEP/r98/
        before_build:
        - run_if_modified:
            pattern: VEP/r98/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: VEP_r93_v2_diff
        deploy: true
        image: kfdrc/VEP
        tag: r93_v2
        path: VEP/r93_v2/
        docker-context: VEP/r93_v2/
        before_build:
        - run_if_modified:
            pattern: VEP/r93_v2/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: VEP_r94_diff
        deploy: true
        image: kfdrc/VEP
        tag: r94
        path: VEP/r94/
        docker-context: VEP/r94/
        before_build:
        - run_if_modified:
            pattern: VEP/r94/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: VEP_r93_diff
        deploy: true
        image: kfdrc/VEP
        tag: r93
        path: VEP/r93/
        docker-context: VEP/r93/
        before_build:
        - run_if_modified:
            pattern: VEP/r93/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: canvas_1.11.0_diff
        deploy: true
        image: kfdrc/canvas
        tag: 1.11.0
        path: canvas/1.11.0/
        docker-context: canvas/1.11.0/
        before_build:
        - run_if_modified:
            pattern: canvas/1.11.0/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: bwa_0.7.15-r1140_diff
        deploy: true
        image: kfdrc/bwa
        tag: 0.7.15-r1140
        path: bwa/0.7.15-r1140/
        docker-context: bwa/0.7.15-r1140/
        before_build:
        - run_if_modified:
            pattern: bwa/0.7.15-r1140/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: bwa_latest_diff
        deploy: true
        image: kfdrc/bwa
        tag: latest
        path: bwa/latest/
        docker-context: bwa/latest/
        before_build:
        - run_if_modified:
            pattern: bwa/latest/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: bwa_0.7.17-r1188_diff
        deploy: true
        image: kfdrc/bwa
        tag: 0.7.17-r1188
        path: bwa/0.7.17-r1188/
        docker-context: bwa/0.7.17-r1188/
        before_build:
        - run_if_modified:
            pattern: bwa/0.7.17-r1188/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: star_2.7.5a_diff
        deploy: true
        image: kfdrc/star
        tag: 2.7.5a
        path: star/2.7.5a/
        docker-context: star/2.7.5a/
        before_build:
        - run_if_modified:
            pattern: star/2.7.5a/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: star_2.6.1d_diff
        deploy: true
        image: kfdrc/star
        tag: 2.6.1d
        path: star/2.6.1d/
        docker-context: star/2.6.1d/
        before_build:
        - run_if_modified:
            pattern: star/2.6.1d/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: star_fusion-1.5.0_diff
        deploy: true
        image: kfdrc/star
        tag: fusion-1.5.0
        path: star/fusion-1.5.0/
        docker-context: star/fusion-1.5.0/
        before_build:
        - run_if_modified:
            pattern: star/fusion-1.5.0/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: codex2_3.8_diff
        deploy: true
        image: kfdrc/codex2
        tag: '3.8'
        path: codex2/3.8/
        docker-context: codex2/3.8/
        before_build:
        - run_if_modified:
            pattern: codex2/3.8/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: sv2_latest_diff
        deploy: true
        image: kfdrc/sv2
        tag: latest
        path: sv2/latest/
        docker-context: sv2/latest/
        before_build:
        - run_if_modified:
            pattern: sv2/latest/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: FusionCatcher_latest_diff
        deploy: true
        image: kfdrc/FusionCatcher
        tag: latest
        path: FusionCatcher/latest/
        docker-context: FusionCatcher/latest/
        before_build:
        - run_if_modified:
            pattern: FusionCatcher/latest/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: controlfreec_11.5_diff
        deploy: true
        image: kfdrc/controlfreec
        tag: '11.5'
        path: controlfreec/11.5/
        docker-context: controlfreec/11.5/
        before_build:
        - run_if_modified:
            pattern: controlfreec/11.5/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: LinkedSV_latest_diff
        deploy: true
        image: kfdrc/LinkedSV
        tag: latest
        path: LinkedSV/latest/
        docker-context: LinkedSV/latest/
        before_build:
        - run_if_modified:
            pattern: LinkedSV/latest/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: gatk_4.beta.6_diff
        deploy: true
        image: kfdrc/gatk
        tag: 4.beta.6
        path: gatk/4.beta.6/
        docker-context: gatk/4.beta.6/
        before_build:
        - run_if_modified:
            pattern: gatk/4.beta.6/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: gatk_4.0.1.0_diff
        deploy: true
        image: kfdrc/gatk
        tag: 4.0.1.0
        path: gatk/4.0.1.0/
        docker-context: gatk/4.0.1.0/
        before_build:
        - run_if_modified:
            pattern: gatk/4.0.1.0/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: gatk_4.beta.1_diff
        deploy: true
        image: kfdrc/gatk
        tag: 4.beta.1
        path: gatk/4.beta.1/
        docker-context: gatk/4.beta.1/
        before_build:
        - run_if_modified:
            pattern: gatk/4.beta.1/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: gatk_4.1.1.0_diff
        deploy: true
        image: kfdrc/gatk
        tag: 4.1.1.0
        path: gatk/4.1.1.0/
        docker-context: gatk/4.1.1.0/
        before_build:
        - run_if_modified:
            pattern: gatk/4.1.1.0/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: gatk_4.beta.1-3.5_diff
        deploy: true
        image: kfdrc/gatk
        tag: 4.beta.1-3.5
        path: gatk/4.beta.1-3.5/
        docker-context: gatk/4.beta.1-3.5/
        before_build:
        - run_if_modified:
            pattern: gatk/4.beta.1-3.5/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: gatk_4.1.7.0R_diff
        deploy: true
        image: kfdrc/gatk
        tag: 4.1.7.0R
        path: gatk/4.1.7.0R/
        docker-context: gatk/4.1.7.0R/
        before_build:
        - run_if_modified:
            pattern: gatk/4.1.7.0R/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: gatk_4.beta.5-tabix_diff
        deploy: true
        image: kfdrc/gatk
        tag: 4.beta.5-tabix
        path: gatk/4.beta.5-tabix/
        docker-context: gatk/4.beta.5-tabix/
        before_build:
        - run_if_modified:
            pattern: gatk/4.beta.5-tabix/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: gatk_4.0.12.0_diff
        deploy: true
        image: kfdrc/gatk
        tag: 4.0.12.0
        path: gatk/4.0.12.0/
        docker-context: gatk/4.0.12.0/
        before_build:
        - run_if_modified:
            pattern: gatk/4.0.12.0/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: gatk_latest_diff
        deploy: true
        image: kfdrc/gatk
        tag: latest
        path: gatk/latest/
        docker-context: gatk/latest/
        before_build:
        - run_if_modified:
            pattern: gatk/latest/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: gatk_3.8_ubuntu_diff
        deploy: true
        image: kfdrc/gatk
        tag: 3.8_ubuntu
        path: gatk/3.8_ubuntu/
        docker-context: gatk/3.8_ubuntu/
        before_build:
        - run_if_modified:
            pattern: gatk/3.8_ubuntu/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: gatk_4.beta.6-tabix_diff
        deploy: true
        image: kfdrc/gatk
        tag: 4.beta.6-tabix
        path: gatk/4.beta.6-tabix/
        docker-context: gatk/4.beta.6-tabix/
        before_build:
        - run_if_modified:
            pattern: gatk/4.beta.6-tabix/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: gatk_4.0.5.2_diff
        deploy: true
        image: kfdrc/gatk
        tag: 4.0.5.2
        path: gatk/4.0.5.2/
        docker-context: gatk/4.0.5.2/
        before_build:
        - run_if_modified:
            pattern: gatk/4.0.5.2/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: gatk_3.5-0-g36282e4_diff
        deploy: true
        image: kfdrc/gatk
        tag: 3.5-0-g36282e4
        path: gatk/3.5-0-g36282e4/
        docker-context: gatk/3.5-0-g36282e4/
        before_build:
        - run_if_modified:
            pattern: gatk/3.5-0-g36282e4/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: gatk_4.beta.5_diff
        deploy: true
        image: kfdrc/gatk
        tag: 4.beta.5
        path: gatk/4.beta.5/
        docker-context: gatk/4.beta.5/
        before_build:
        - run_if_modified:
            pattern: gatk/4.beta.5/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: gatk_3.6-0-g89b7209_diff
        deploy: true
        image: kfdrc/gatk
        tag: 3.6-0-g89b7209
        path: gatk/3.6-0-g89b7209/
        docker-context: gatk/3.6-0-g89b7209/
        before_build:
        - run_if_modified:
            pattern: gatk/3.6-0-g89b7209/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: gatk_4.0.1.2_diff
        deploy: true
        image: kfdrc/gatk
        tag: 4.0.1.2
        path: gatk/4.0.1.2/
        docker-context: gatk/4.0.1.2/
        before_build:
        - run_if_modified:
            pattern: gatk/4.0.1.2/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: gatk_3.8_diff
        deploy: true
        image: kfdrc/gatk
        tag: '3.8'
        path: gatk/3.8/
        docker-context: gatk/3.8/
        before_build:
        - run_if_modified:
            pattern: gatk/3.8/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: bed_tools_bedopsv2.4.36_plus_bedtools_diff
        deploy: true
        image: kfdrc/bed_tools
        tag: bedopsv2.4.36_plus_bedtools
        path: bed_tools/bedopsv2.4.36_plus_bedtools/
        docker-context: bed_tools/bedopsv2.4.36_plus_bedtools/
        before_build:
        - run_if_modified:
            pattern: bed_tools/bedopsv2.4.36_plus_bedtools/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: peddy_latest_diff
        deploy: true
        image: kfdrc/peddy
        tag: latest
        path: peddy/latest/
        docker-context: peddy/latest/
        before_build:
        - run_if_modified:
            pattern: peddy/latest/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: samtools_1.7-11-g041220d_diff
        deploy: true
        image: kfdrc/samtools
        tag: 1.7-11-g041220d
        path: samtools/1.7-11-g041220d/
        docker-context: samtools/1.7-11-g041220d/
        before_build:
        - run_if_modified:
            pattern: samtools/1.7-11-g041220d/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: samtools_1.9_diff
        deploy: true
        image: kfdrc/samtools
        tag: '1.9'
        path: samtools/1.9/
        docker-context: samtools/1.9/
        before_build:
        - run_if_modified:
            pattern: samtools/1.9/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: samtools_1.6_diff
        deploy: true
        image: kfdrc/samtools
        tag: '1.6'
        path: samtools/1.6/
        docker-context: samtools/1.6/
        before_build:
        - run_if_modified:
            pattern: samtools/1.6/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: samtools_1.3.1_diff
        deploy: true
        image: kfdrc/samtools
        tag: 1.3.1
        path: samtools/1.3.1/
        docker-context: samtools/1.3.1/
        before_build:
        - run_if_modified:
            pattern: samtools/1.3.1/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: samtools_latest_diff
        deploy: true
        image: kfdrc/samtools
        tag: latest
        path: samtools/latest/
        docker-context: samtools/latest/
        before_build:
        - run_if_modified:
            pattern: samtools/latest/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: annovar_latest_diff
        deploy: true
        image: kfdrc/annovar
        tag: latest
        path: annovar/latest/
        docker-context: annovar/latest/
        before_build:
        - run_if_modified:
            pattern: annovar/latest/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: seurat_latest_diff
        deploy: true
        image: kfdrc/seurat
        tag: latest
        path: seurat/latest/
        docker-context: seurat/latest/
        before_build:
        - run_if_modified:
            pattern: seurat/latest/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: annoFuse_0.1.8_diff
        deploy: true
        image: kfdrc/annoFuse
        tag: 0.1.8
        path: annoFuse/0.1.8/
        docker-context: annoFuse/0.1.8/
        before_build:
        - run_if_modified:
            pattern: annoFuse/0.1.8/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: pizzly_latest_diff
        deploy: true
        image: kfdrc/pizzly
        tag: latest
        path: pizzly/latest/
        docker-context: pizzly/latest/
        before_build:
        - run_if_modified:
            pattern: pizzly/latest/Dockerfile
    - docker/publish:
        context: dockerhub-vars
        name: BIC-seq2_0.7.2_diff
        deploy: true
        image: kfdrc/BIC-seq2
        tag: 0.7.2
        path: BIC-seq2/0.7.2/
        docker-context: BIC-seq2/0.7.2/
        before_build:
        - run_if_modified:
            pattern: BIC-seq2/0.7.2/Dockerfile
